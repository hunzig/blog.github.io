<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Docker 容器数据卷挂载小结 | hack70</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Docker 容器数据卷挂载小结</h1><a id="logo" href="/.">hack70</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Docker 容器数据卷挂载小结</h1><div class="post-meta">Apr 22, 2017<span> | </span><span class="category"><a href="/categories/linux/">linux</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><blockquote>
<p>为了更直观了解数据卷挂载的操作，做个实验一一验证数据卷挂载的各种情况。</p>
</blockquote>
<h3 id="情况一、本地不存在文件挂载到容器存在文件"><a href="#情况一、本地不存在文件挂载到容器存在文件" class="headerlink" title="情况一、本地不存在文件挂载到容器存在文件"></a>情况一、本地不存在文件挂载到容器存在文件</h3><p>首先是当本地不存在该文件，而容器内存在该文件的情况，尝试把不存在的文件挂载到存在该文件的容器中。以一个 Alpine 镜像为例，这里把一个修改后的 Alpine 镜像打了新标签，叫做 volume_test：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 本地目录不存在 test 文件。</div><div class="line">$ docker run --name=test -v ~/test.txt:/etc/hosts -d volume_test</div><div class="line">0cba2e50229df7508c616bd456c4ab131f2fe1a88385c34f8a5876fbc577b176</div><div class="line">docker: Error response from daemon: oci runtime error: rootfs_linux.go:53: mounting &quot;/var/lib/docker/devicemapper/mnt/6b83c07ebedcb828f34cac69eac5a85ce3a5f59e1e8688c8dae40198671d0ecb/rootfs/etc/hosts&quot; to rootfs &quot;/var/lib/docker/devicemapper/mnt/6b83c07ebedcb828f34cac69eac5a85ce3a5f59e1e8688c8dae40198671d0ecb/rootfs&quot; caused &quot;not a directory&quot;.</div><div class="line"># 启动容器失败。</div></pre></td></tr></table></figure></p>
<h3 id="情况二、本地不存在文件夹挂载到容器存在文件夹"><a href="#情况二、本地不存在文件夹挂载到容器存在文件夹" class="headerlink" title="情况二、本地不存在文件夹挂载到容器存在文件夹"></a>情况二、本地不存在文件夹挂载到容器存在文件夹</h3><p>然后是把本地不存在的文件夹挂载到容器内存在的文件夹，在 volume_test 镜像中存在一个 /srv 的文件夹，文件夹里面有一个 index.php 文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 本地目录不存在 srv文件夹。</div><div class="line">$ docker run --name=test -v ~/srv:/srv -d volume_test </div><div class="line">c71cf1cfa4932e3e398a7d6c4e2ae94f915b832f5506e374aedb19af4cb1ac62</div><div class="line"># 启动正常，但是进入容器发现目录被清空。</div><div class="line">$ docker exec -it test sh</div><div class="line">/srv # ls</div><div class="line">/srv #</div></pre></td></tr></table></figure></p>
<p>上面两个例子已经告诉我们，数据卷的挂载是通过把本地的目录覆盖到容器中的。也就是说，当宿主机文件不存在时，不能挂载；当文件夹不存在时，挂载到容器会用一个空文件夹覆盖容器原有目录。</p>
<h3 id="情况三、宿主机存在文件挂载到容器不存在文件"><a href="#情况三、宿主机存在文件挂载到容器不存在文件" class="headerlink" title="情况三、宿主机存在文件挂载到容器不存在文件"></a>情况三、宿主机存在文件挂载到容器不存在文件</h3><p>我们继续，假设宿主机存在文件，容器内不存在该文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 本地目录存在 test.txt文件</div><div class="line">$ docker run --name=test -v ~/test.txt:/srv/test.txt-d volume_test </div><div class="line">2d6853c10643a735ae3d7f3aaac8c6344f9c75170e531f613d08db7cdf484e54</div><div class="line"># 容器内存在 /srv 文件夹，里面原本有一个 index.php 。</div><div class="line">$ docker exec -it test sh</div><div class="line">/srv # ls</div><div class="line">index.php  test.txt</div><div class="line">/srv # </div><div class="line"># 可以看到文件挂载成功。</div></pre></td></tr></table></figure></p>
<h3 id="情况四、宿主机存在文件夹挂载到容器不存在文件夹"><a href="#情况四、宿主机存在文件夹挂载到容器不存在文件夹" class="headerlink" title="情况四、宿主机存在文件夹挂载到容器不存在文件夹"></a>情况四、宿主机存在文件夹挂载到容器不存在文件夹</h3><p>接下来是宿主机存在文件夹，容器不存在该文件夹，宿主机的 test 文件夹里面存在一个 hello 文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ docker run --name=test -v ~/test:/srv/test -d volume_test </div><div class="line">c935ffa0d9fc5e5ac8f213a51a878e71056472b0597d2e385a29e5c748012958</div><div class="line"># 进入容器，查看是否存在 test 文件夹，以及文件夹里面是否有 hello 文件。</div><div class="line">$ docker exec -it test sh</div><div class="line">/srv # ls</div><div class="line">index.php  test</div><div class="line">/srv # cd test/</div><div class="line">/srv/test # ls</div><div class="line">hello</div><div class="line">/srv/test #</div></pre></td></tr></table></figure></p>
<p>上面两个例子说明了，容器内部如果不存在文件，宿主机直接挂载。</p>
<h3 id="情况五、宿主机文件夹挂载到容器文件"><a href="#情况五、宿主机文件夹挂载到容器文件" class="headerlink" title="情况五、宿主机文件夹挂载到容器文件"></a>情况五、宿主机文件夹挂载到容器文件</h3><p>接下来假设宿主机存在 test 文件夹，而容器内部存在的是名为 test 文件，这样挂载会怎样呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ docker run --name=test -v ~/test:/srv/test-d volume_test </div><div class="line">385bc78e5333460da11f04535da27a3fd226df218f95c970ff2dd5609b17f816</div><div class="line">docker: Error response from daemon: oci runtime error: rootfs_linux.go:53: mounting &quot;/var/lib/docker/devicemapper/mnt/fd5c42e844c3550d1a372ed939ed57f90dcacbd375dfed1bedfbb71ef6f3f185/rootfs/etc/hosts&quot; to rootfs &quot;/var/lib/docker/devicemapper/mnt/fd5c42e844c3550d1a372ed939ed57f90dcacbd375dfed1bedfbb71ef6f3f185/rootfs&quot; caused &quot;not a directory&quot;.</div></pre></td></tr></table></figure></p>
<p>上面的情况不出意外是启动错误。</p>
<h3 id="情况六、同名文件夹挂载"><a href="#情况六、同名文件夹挂载" class="headerlink" title="情况六、同名文件夹挂载"></a>情况六、同名文件夹挂载</h3><p>那么假设宿主机是文件夹，容器也是文件夹，两个文件夹里面内容不一样，宿主机内部有一个 hello 文件，容器的文件夹里面有一个 index.php ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ docker run --name=test -v ~/srv:/srv -d volume_test </div><div class="line">3aec30122bd7010c694e0ff8b77f7b7b6bb6f850c258786db125313060fad43b$ docker exec-it test sh</div><div class="line">/srv # ls</div><div class="line">hello</div><div class="line">/srv # </div><div class="line"># 可以看到，宿主机文件夹会覆盖容器内部的文件夹。</div></pre></td></tr></table></figure></p>
<h3 id="情况七、同名文件挂载"><a href="#情况七、同名文件挂载" class="headerlink" title="情况七、同名文件挂载"></a>情况七、同名文件挂载</h3><p>假设宿主机有一个 test.txt 文件，里面写着 Hello World，而容器里面也存在一个 test.txt 文件，里面写着 Hi World，现在挂载文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ docker run --name=test -v ~/test.txt:/srv/test.txt -d volume_test </div><div class="line">047cbfe45b5bc868c864fe94f7a22643d52b644947f40260097dbb579de56c5c</div><div class="line">$ docker exec -it test sh</div><div class="line">/srv # cat /test</div><div class="line">Hello World</div><div class="line">/srv # </div><div class="line"># 宿主机会覆盖容器的文件。</div></pre></td></tr></table></figure></p>
<h3 id="情况八、宿主机文件挂载到容器文件夹"><a href="#情况八、宿主机文件挂载到容器文件夹" class="headerlink" title="情况八、宿主机文件挂载到容器文件夹"></a>情况八、宿主机文件挂载到容器文件夹</h3><p>最后一种情况，宿主机存在文件 test.txt，而容器内部存在一个 test 的文件夹，现在把 文件挂载到文件夹中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ docker run --name=test -v ~/test.txt:/test -d volume_test </div><div class="line">59b5fd74a1e9e17aa2a6a9be7900b16c7dd4b3c424a4fa72a7671fa1c51bdf69</div><div class="line">docker: Error response from daemon: oci runtime error: rootfs_linux.go:53: mounting &quot;/var/lib/docker/devicemapper/mnt/b201054ed36a189b5abb599082d0b5bcbe31d07611a0985deefd79d1221447fd/rootfs/home&quot; to rootfs &quot;/var/lib/docker/devicemapper/mnt/b201054ed36a189b5abb599082d0b5bcbe31d07611a0985deefd79d1221447fd/rootfs&quot; caused &quot;not a directory&quot;.</div><div class="line"># 启动失败。</div></pre></td></tr></table></figure></p>
<p><strong>小结：</strong></p>
<table>
<thead>
<tr>
<th>宿主机文件</th>
<th>容器内文件</th>
<th>启动参数（加粗表示不存在）</th>
<th>容器启动情况</th>
</tr>
</thead>
<tbody>
<tr>
<td>不存在</td>
<td>文件</td>
<td>-v ~/test.txt:/etc/hosts</td>
<td>启动错误</td>
</tr>
<tr>
<td>不存在</td>
<td>文件夹</td>
<td>-v ~/srv:/srv</td>
<td>启动正常</td>
</tr>
<tr>
<td>文件</td>
<td>不存在</td>
<td>-v ~/test.txt:/srv/test.txt</td>
<td>启动正常</td>
</tr>
<tr>
<td>文件夹</td>
<td>不存在</td>
<td>~/test:/srv/test</td>
<td>启动正常</td>
</tr>
<tr>
<td>文件夹</td>
<td>文件</td>
<td>~/test:/srv/test</td>
<td>启动错误</td>
</tr>
<tr>
<td>文件夹</td>
<td>文件夹</td>
<td>-v ~/srv:/srv</td>
<td>启动正常</td>
</tr>
<tr>
<td>文件</td>
<td>文件</td>
<td>-v ~/test.txt:/srv/test.txt</td>
<td>启动正常</td>
</tr>
<tr>
<td>文件</td>
<td>文件夹</td>
<td>-v ~/test.txt:/test</td>
<td>启动错误</td>
</tr>
</tbody>
</table>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://hack70.com/2017/04/22/026docker-volume/" data-id="cj1sm3kwq00006syjxlxt8qtt" class="article-share-link">分享到</a><div class="tags"><a href="/tags/docker/">docker</a></div><div class="post-nav"><a href="/2017/04/22/027docker-volume2/" class="pre">关于Docker目录挂载的总结</a><a href="/2017/04/21/025genymotion/" class="next">genymotion的那些事儿</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://hack70.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/forensics/">forensics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hack/">hack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/raspberry/" style="font-size: 15px;">raspberry</a> <a href="/tags/wireless/" style="font-size: 15px;">wireless</a> <a href="/tags/免流/" style="font-size: 15px;">免流</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/manjaro/" style="font-size: 15px;">manjaro</a> <a href="/tags/梅林/" style="font-size: 15px;">梅林</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/vps/" style="font-size: 15px;">vps</a> <a href="/tags/genymotion/" style="font-size: 15px;">genymotion</a> <a href="/tags/kali/" style="font-size: 15px;">kali</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/27/043日志查看相关linux命令/">日志查看相关linux命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/26/042安卓手机位置取证/">安卓手机地理位置信息取证</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/25/041如何破解微信加密数据库EnMicroMsg.db读取聊天消息/">如何破解微信加密数据库EnMicroMsg.db读取聊天消息</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/040Vulnhub - Mr. Robot CTF Video Walkthrough/">Vulnhub - Mr. Robot CTF Video Walkthrough</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/039sublime-rumen /">如何优雅地使用sublime</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/032weijizhan-forensics/">伪基站鉴定相关要点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/031kali-forensics/">kali计算机取证——安全牛</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/037change-vps-time /">vps修改时区</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/036yijuhua /">一句话木马</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/035lshack /">lshack拿站实例</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.douban.com/" title="douban" target="_blank">douban</a><ul></ul><a href="http://www.v2ex.com/" title="v2ex" target="_blank">v2ex</a><ul></ul><a href="http://www.github.com/" title="github" target="_blank">github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">hack70.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>