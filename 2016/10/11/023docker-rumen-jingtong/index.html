<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>docker从入门到精通 | hack70</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">docker从入门到精通</h1><a id="logo" href="/.">hack70</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">docker从入门到精通</h1><div class="post-meta">Oct 11, 2016<span> | </span><span class="category"><a href="/categories/linux/">linux</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h3 id="云计算模式"><a href="#云计算模式" class="headerlink" title="云计算模式"></a>云计算模式</h3><p>Iaas：基础设施即服务     亚马逊AWS、阿里云（虚拟机、服务器、存储、网络）<br>Paas：平台即服务   google app engine、dotcloud （可执行环境、数据库、开发环境）<br>Saas：软件即服务   有道、麦客 （邮件、虚拟桌面、办公软件）</p>
<h3 id="linux基础知识"><a href="#linux基础知识" class="headerlink" title="linux基础知识"></a>linux基础知识</h3><ul>
<li>启用root用户：sudo passwd，通过su命令切换到root用户</li>
<li><p>配置网络：编辑/etc/network/interfaces</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">auto eth0</div><div class="line">iface eth0 inet static</div><div class="line">address 192.168.1.10</div><div class="line">netmask 255.255.255.0</div><div class="line">gateway 192.168.0.1</div><div class="line">dns-nameserver 61.139.2.69 218.200.139</div></pre></td></tr></table></figure>
</li>
<li><p>修改完毕重启网络，一个比较好的方式是禁用再启用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ifdown -a &amp;&amp; ifup -a</div></pre></td></tr></table></figure>
</li>
<li><p>启用ssh server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dpkg -l | grep openssh-server</div></pre></td></tr></table></figure>
</li>
</ul>
<p>配置ssh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /etc/ssh/sshd_config</div><div class="line">PermitRootLogin yes</div><div class="line">PasswordAuthentication yes</div><div class="line">restart ssh</div><div class="line">- 免密码登录linux主机（生成公钥和私钥）</div></pre></td></tr></table></figure></p>
<p>ssh-keygen<br>scp ~/.ssh/id_rsa.pub root@192.168.1.10:~/   #当前用户的公钥拷贝到远程机器root用户下<br>ssh root@192.168.1.10<br>ssh-kegen  #在远端产生密钥<br>cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_key  #加入信任列表<br>rm id_rsa.pub   #删除公钥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- 软件库里搜索软件</div></pre></td></tr></table></figure></p>
<p>apt-cache search apache2 | grep ^apache2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- 查找本地安装的软件</div></pre></td></tr></table></figure></p>
<p>dpkg -l<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">### 云主机相关知识</div><div class="line">- 修改主机名</div></pre></td></tr></table></figure></p>
<p>hostname ghostcloud<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">### docker的安装</div><div class="line">支持版本 ubuntu 15.10 14.04 12.04</div><div class="line">linux内核必须高于3.10的64位系统，通过uname -r 查看内核版本</div><div class="line">通过官方安装脚本安装</div></pre></td></tr></table></figure></p>
<p>curl -fsSL <a href="https://get.docker.com" target="_blank" rel="external">https://get.docker.com</a> | sh</p>
<h3 id="使用docker"><a href="#使用docker" class="headerlink" title="使用docker"></a>使用docker</h3><ul>
<li>查看镜像 docker images</li>
<li>REPOSITORY 镜像名称</li>
<li>TAG 镜像版本，默认是latest</li>
<li>IMAGE ID 这是镜像截短后的ID</li>
<li>CREATED 镜像是什么时候创建的，这个时间是指的仓库里面的时间</li>
<li>VIRTUAL SIZE 镜像所占空间的大小</li>
</ul>
<p>＊＊杀掉容器进程  docker kill container_id＊＊</p>
<blockquote>
<p>容器五种网络模式：<br>none 该模式下容器没有对外网络，本机只有一个回路地址<br>container  与另一个容器共享网络<br>host 与主机共享网络<br>bridge docker默认网络模式，docker容器与外部的通信通过iptable来实现<br>overlay docker目前原生的跨主机多子网模型，主要通过vxlan技术来实现</p>
</blockquote>
<p>先使用默认桥接方式进行服务导出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">JOB=$(docker run -d -p 4444 ubuntu /bin/nc -L 4444) #在容器中启动nc监听在4444端口</div><div class="line">docker port $JOB #查看容器导出的端口</div><div class="line">4444/tcp -&gt; 0.0.0.0:32768</div><div class="line">echo hello world | nc 127.0.0.1 32768  # 向主机发送hello world</div><div class="line">docker logs $JOB  #确认主机是否收到消息</div><div class="line">hello world</div></pre></td></tr></table></figure></p>
<p>nc 一个简单的网络程序，监听在制定端口，并打印收到的数据<br>-p 表示容器内部的端口，由于没有指定主机端口，主机端口是随机分配的，默认是从32768开始<br>外部程序端口 通过docker port 可以查看容器的端口映射关系</p>
<p><strong>容器转化成镜像</strong><br>docker commit container_id repository #commit转化的原因是容器并不会修改镜像内容,用commit将修改保存进镜像文件</p>
<p><strong>容器的基础命令</strong><br>docker pull<br>docker run<br>docker images<br>docker ps<br>docker stop/start/restart/kill<br>docker log</p>
<p><strong>通过docker –help 查看docker所有命令及选项</strong><br><strong>通过docker command –help 查看每个命令的详细用法</strong><br><strong>通过docker daemon –help 查看服务器端命令用法</strong></p>
<p><strong>docker 配置文件在/etc/default/docker</strong><br><strong>查看docker 版本  docker version</strong><br><strong>查看镜像详细信息 docker inspect centos</strong></p>
<blockquote>
<p>使用国内ghostcloud网站的仓库<br>–insecure-registry=hub.ghostcloud.cn 添加入 /etc/default/docker</p>
</blockquote>
<p><strong>进入容器的命令</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker exec -it container_id /bin/bash  #退出后进程不会关闭</div><div class="line">docker attach container_id   #退出后进程被关闭</div></pre></td></tr></table></figure></p>
<p><strong>上传镜像到远端服务器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker tag myubuntu hub.ghostcloud.cn/yandong/myubuntu #先用tag语法重新标记</div><div class="line">docker push hub.ghostcloud.cn/yandong/myubuntu  #push上传</div></pre></td></tr></table></figure></p>
<p><strong>根据dockerfile编译镜像</strong><br>创建一个文件夹,并新建一个dockerfile文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat Dockerfile</div><div class="line"># This is a comment</div><div class="line">FROM ubuntu:latest</div><div class="line">MAINTAINER Shev Yan &lt;yandong_8212@163.com&gt;</div><div class="line">CMD echo &apos;hello my image from Dockerfile.&apos;</div></pre></td></tr></table></figure></p>
<p>Build<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">docker build .</div><div class="line">Sending build context to Docker doemon 2.048 kB</div><div class="line">Step 1 : FROM ubuntu:latest</div><div class="line">---&gt; 8ed581e3fa7a</div><div class="line">Step 2 : MAINTAINER Shev Yan  &lt;yandong_8212@163.com&gt;</div><div class="line">---&gt; Running in 9b9d552f8184</div><div class="line">---&gt; 727c430beada</div><div class="line">Removing intermediate container 9b9d552f8184</div><div class="line">Step 3 : CMD echo &apos;hello my image from Dockerfile.&apos;</div><div class="line">---&gt; Running in 343f2abeb557</div><div class="line">---&gt; 30331f9ff01a</div><div class="line">Remoing intermediate container 343f2abeb557</div><div class="line">Successfully built 30331f9ff01a</div></pre></td></tr></table></figure></p>
<p><strong>删除镜像</strong><br>docker imi myimage</p>
<p><strong>容器后台运行</strong><br>-d 参数运行后,如果要再次进入容器可以使用docker attach<cid>的方式, 退出要用ctrl+pq<br><strong>前台运行</strong><br>-it 参数</cid></p>
<p><strong>容器的标识</strong><br>–name 指定容器的名字,比较打的用途就是可以用于两个容器之间建立link通信</p>
<p><strong>查看容器中进程PID</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -ef</div></pre></td></tr></table></figure></p>
<p><strong>特权模式</strong><br>如果你希望使用主机上某个特定设备<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --device=/dev/snd:/dev/snd</div></pre></td></tr></table></figure></p>
<p><strong>容器的数据</strong>(映射\调用)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker run -d -P --name datatest -v /webapp ubuntu # /webapp为容器内部目录,主机目录自动产生,查看用docker inspect container_id,一般在/var/lib/docker/volumes下</div><div class="line">docker run -id -v /root:/hostroot ubuntu # 将主机/root目录映射到容器的/hostroot目录</div></pre></td></tr></table></figure></p>
<ul>
<li>创建一个数据型容器然后调用给另外一个容器使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker create -v /dbdata --name dbstore ubuntu</div><div class="line">docker run --rm -it --volumes-from dbstore ubuntu  # --rm 指运行结束后清理保存的数据,--rm不能与-d 共存</div><div class="line">df -h #在容器中运行查看共享进来的数据容器在本容器中的映射位置</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>备份、还原和迁移数据卷</strong><br>数据卷和数据型容器联合使用做备份的例子<br>```<br>docker run –rm –volumes-from dbstore -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /dbdata   #将容器的/dbdate打包到/backup目录下,然后映射到本机的当前目录<br>docker run –rm –volumes-from dbstore2 -v $(pwd):/backup ubuntu bash -c “cd /dbdata &amp;&amp; tar xvf /backup/backup.tar –strip 1” # 还原回去</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://hack70.com/2016/10/11/023docker-rumen-jingtong/" data-id="cj1rrp6l6001s28yjayp3youm" class="article-share-link">分享到</a><div class="tags"><a href="/tags/docker/">docker</a></div><div class="post-nav"><a href="/2017/01/27/024linux-hydra/" class="pre">linux下的暴力密码在线破解工具hydra详解</a><a href="/2016/10/09/022docker-jianmin2/" class="next">docker简明教程二</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://hack70.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/forensics/">forensics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hack/">hack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/raspberry/" style="font-size: 15px;">raspberry</a> <a href="/tags/wireless/" style="font-size: 15px;">wireless</a> <a href="/tags/免流/" style="font-size: 15px;">免流</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/manjaro/" style="font-size: 15px;">manjaro</a> <a href="/tags/梅林/" style="font-size: 15px;">梅林</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/vps/" style="font-size: 15px;">vps</a> <a href="/tags/genymotion/" style="font-size: 15px;">genymotion</a> <a href="/tags/kali/" style="font-size: 15px;">kali</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/040Vulnhub - Mr. Robot CTF Video Walkthrough/">Vulnhub - Mr. Robot CTF Video Walkthrough</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/039sublime-rumen /">如何优雅地使用sublime</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/032weijizhan-forensics/">伪基站鉴定相关要点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/031kali-forensics/">kali计算机取证——安全牛</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/037change-vps-time /">vps修改时区</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/036yijuhua /">一句话木马</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/035lshack /">lshack拿站实例</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/034ddos-tools /">ddos相关工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/033android-forensics/">安卓取证相关要点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/22/030Kali-Persistence2/">Kali Liveģʽ�µ�Persistence</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.douban.com/" title="douban" target="_blank">douban</a><ul></ul><a href="http://www.v2ex.com/" title="v2ex" target="_blank">v2ex</a><ul></ul><a href="http://www.github.com/" title="github" target="_blank">github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">hack70.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>